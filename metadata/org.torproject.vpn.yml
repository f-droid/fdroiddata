Categories:
  - VPN & Proxy
License: BSD-3-Clause-Clear
WebSite: https://www.torproject.org/
SourceCode: https://gitlab.torproject.org/tpo/applications/vpn/
IssueTracker: https://gitlab.torproject.org/tpo/applications/vpn/-/issues/
Translation: https://hosted.weblate.org/projects/tor/tor-vpn/
Changelog: https://gitlab.torproject.org/tpo/applications/vpn/-/blob/HEAD/CHANGELOG.md
Donate: https://donate.torproject.org/
Bitcoin: bc1qtt04zfgjxg7lpqhk9vk8hnmnwf88ucwww5arsd

AutoName: Tor VPN

RepoType: git
Repo: https://gitlab.torproject.org/tpo/applications/vpn.git

Builds:
  - versionName: 1.5.0Beta
    versionCode: 191
    commit: 2f22b81491be1bc4569fb8a9a4edcd61997d6d19
    subdir: app
    sudo:
      - apt-get update
      - apt-get install cmake make gcc libc-dev rustup
    gradle:
      - armeabiv7a
    output: build/outputs/apk/armeabiv7a/release/app-armeabiv7a-release-unsigned.apk
    binary: https://dist.torproject.org/torvpn/%v/tor-vpn-android-armv7-%v.apk
    srclibs:
      - onionmasq@fc27c71d341ee2b8a6cb5db534458ad598a14135
      - reproducible-apk-tools@v0.3.0
    prebuild:
      - rustup default 1.87.0
      - rustup target add armv7-linux-androideabi
      - ./../scripts/reproducible_fetch_rust_deps.sh
      - export ANDROID_NDK_ROOT=$$NDK$$
      - sed -i -e "s/gitlab.torproject.org.*'/maven.google.com'/" ../build.gradle
    build:
      - export ANDROID_NDK_ROOT=$$NDK$$
      - export ONIONMASQ_HASH=$(cat ../scripts/onionmasq.hash)
      - echo $ONIONMASQ_HASH
      - pushd $$onionmasq$$
      - git checkout -f $ONIONMASQ_HASH
      - ./build-ndk.sh armeabi-v7a
      - cd android/OnionmasqAndroid
      - gradle :onionmasq:build
      - gradle :onionmasq:publishLibraryReleasePublicationToMavenLocal
      - popd
    ndk: r27d
    postbuild:
      - mv $$OUT$$ unaligned.apk
      - $$reproducible-apk-tools$$/zipalign.py --page-size 16 --pad-like-apksigner
        --replace unaligned.apk $$OUT$$

  - versionName: 1.5.0Beta
    versionCode: 192
    commit: 2f22b81491be1bc4569fb8a9a4edcd61997d6d19
    subdir: app
    sudo:
      - apt-get update
      - apt-get install cmake make gcc libc-dev rustup
    gradle:
      - arm64v8a
    output: build/outputs/apk/arm64v8a/release/app-arm64v8a-release-unsigned.apk
    binary: https://dist.torproject.org/torvpn/%v/tor-vpn-android-aarch64-%v.apk
    srclibs:
      - onionmasq@fc27c71d341ee2b8a6cb5db534458ad598a14135
      - reproducible-apk-tools@v0.3.0
    prebuild:
      - rustup default 1.87.0
      - rustup target add aarch64-linux-android
      - ./../scripts/reproducible_fetch_rust_deps.sh
      - export ANDROID_NDK_ROOT=$$NDK$$
      - sed -i -e "s/gitlab.torproject.org.*'/maven.google.com'/" ../build.gradle
    build:
      - export ANDROID_NDK_ROOT=$$NDK$$
      - export ONIONMASQ_HASH=$(cat ../scripts/onionmasq.hash)
      - echo $ONIONMASQ_HASH
      - pushd $$onionmasq$$
      - git checkout -f $ONIONMASQ_HASH
      - ./build-ndk.sh arm64-v8a
      - cd android/OnionmasqAndroid
      - gradle :onionmasq:build
      - gradle :onionmasq:publishLibraryReleasePublicationToMavenLocal
      - popd
    ndk: r27d
    postbuild:
      - mv $$OUT$$ unaligned.apk
      - $$reproducible-apk-tools$$/zipalign.py --page-size 16 --pad-like-apksigner
        --replace unaligned.apk $$OUT$$

  - versionName: 1.5.0Beta
    versionCode: 193
    commit: 2f22b81491be1bc4569fb8a9a4edcd61997d6d19
    subdir: app
    sudo:
      - apt-get update
      - apt-get install cmake make gcc libc-dev rustup
    gradle:
      - x86
    output: build/outputs/apk/x86/release/app-x86-release-unsigned.apk
    binary: https://dist.torproject.org/torvpn/%v/tor-vpn-android-x86-%v.apk
    srclibs:
      - onionmasq@fc27c71d341ee2b8a6cb5db534458ad598a14135
      - reproducible-apk-tools@v0.3.0
    prebuild:
      - rustup default 1.87.0
      - rustup target add i686-linux-android
      - ./../scripts/reproducible_fetch_rust_deps.sh
      - export ANDROID_NDK_ROOT=$$NDK$$
      - sed -i -e "s/gitlab.torproject.org.*'/maven.google.com'/" ../build.gradle
    build:
      - export ANDROID_NDK_ROOT=$$NDK$$
      - export ONIONMASQ_HASH=$(cat ../scripts/onionmasq.hash)
      - echo $ONIONMASQ_HASH
      - pushd $$onionmasq$$
      - git checkout -f $ONIONMASQ_HASH
      - ./build-ndk.sh x86
      - cd android/OnionmasqAndroid
      - gradle :onionmasq:build
      - gradle :onionmasq:publishLibraryReleasePublicationToMavenLocal
      - popd
    ndk: r27d
    postbuild:
      - mv $$OUT$$ unaligned.apk
      - $$reproducible-apk-tools$$/zipalign.py --page-size 16 --pad-like-apksigner
        --replace unaligned.apk $$OUT$$

  - versionName: 1.5.0Beta
    versionCode: 194
    commit: 2f22b81491be1bc4569fb8a9a4edcd61997d6d19
    subdir: app
    sudo:
      - apt-get update
      - apt-get install cmake make gcc libc-dev rustup
    gradle:
      - x86_64
    output: build/outputs/apk/x86_64/release/app-x86_64-release-unsigned.apk
    binary: https://dist.torproject.org/torvpn/%v/tor-vpn-android-x86_64-%v.apk
    srclibs:
      - onionmasq@fc27c71d341ee2b8a6cb5db534458ad598a14135
      - reproducible-apk-tools@v0.3.0
    prebuild:
      - rustup default 1.87.0
      - rustup target add x86_64-linux-android
      - ./../scripts/reproducible_fetch_rust_deps.sh
      - export ANDROID_NDK_ROOT=$$NDK$$
      - sed -i -e "s/gitlab.torproject.org.*'/maven.google.com'/" ../build.gradle
    build:
      - export ANDROID_NDK_ROOT=$$NDK$$
      - export ONIONMASQ_HASH=$(cat ../scripts/onionmasq.hash)
      - echo $ONIONMASQ_HASH
      - pushd $$onionmasq$$
      - git checkout -f $ONIONMASQ_HASH
      - ./build-ndk.sh x86_64
      - cd android/OnionmasqAndroid
      - gradle :onionmasq:build
      - gradle :onionmasq:publishLibraryReleasePublicationToMavenLocal
      - popd
    ndk: r27d
    postbuild:
      - mv $$OUT$$ unaligned.apk
      - $$reproducible-apk-tools$$/zipalign.py --page-size 16 --pad-like-apksigner
        --replace unaligned.apk $$OUT$$

AllowedAPKSigningKeys: c2f6ffa30e56a7c53a226248ef908612ee539df2f52bede5a55037425b83331d

AutoUpdateMode: Version
UpdateCheckMode: Tags
VercodeOperation:
  - 10 * %c + 1
  - 10 * %c + 2
  - 10 * %c + 3
  - 10 * %c + 4
CurrentVersion: 1.5.0Beta
CurrentVersionCode: 194
