AntiFeatures:
  NonFreeNet:
    en-US: Depends on Pixiv and connects GitHub for update check.
Categories:
  - Graphics
  - Internet
  - Multimedia
License: GPL-3.0-only
AuthorName: kagg886
WebSite: https://pmf.kagg886.top
SourceCode: https://github.com/magic-cucumber/Pixiv-MultiPlatform
IssueTracker: https://github.com/magic-cucumber/Pixiv-MultiPlatform/issues
Changelog: https://github.com/magic-cucumber/Pixiv-MultiPlatform/releases

AutoName: Pixiv

RepoType: git
Repo: https://github.com/magic-cucumber/Pixiv-MultiPlatform
Binaries: 
  https://github.com/magic-cucumber/Pixiv-MultiPlatform/releases/download/v%v/android.apk

Builds:
  - versionName: 1.6.5
    versionCode: 165
    commit: 0a34e4e58da2a506e8e7d080badfdd91c94d504e
    subdir: composeApp
    gradle:
      - yes
    rm:
      - iosApp
      - plugin
    prebuild:
      - sed -i -e '/compose-desktop-build-windows/d' -e '/foojay/d' -e '/jogamp/d'
        ../settings.gradle.kts
      - sed -i -e '/signConfig/d' -e '/top.kagg886.compose.installer.windows/d' -e
        '/configureComposeWindowsInstaller {/,/^}/d' build.gradle.kts
      - echo -e '\nAPP_VERSION_NAME=v$$VERSION$$' >> ../gradle.properties
      - gradle exportLibraryDefinitions -PaboutLibraries.exportVariant=release

  - versionName: 1.7.1
    versionCode: 171
    commit: dd0469f94ba34885f340b641efa8efaf46ee2996
    subdir: composeApp
    gradle:
      - yes
    srclibs:
      - rustup@1.27.1
    rm:
      - iosApp
      - plugin
    prebuild:
      - sed -i -e '/compose-desktop-build-windows/d' -e '/foojay/d' -e '/jogamp/d'
        ../settings.gradle.kts
      - sed -i -e '/signConfig/d' -e '/top.kagg886.compose.installer.windows/d' -e
        '/configureComposeWindowsInstaller {/,/^}/d' build.gradle.kts
      - echo -e '\nAPP_VERSION_NAME=v$$VERSION$$' >> ../gradle.properties
      - gradle exportLibraryDefinitions -PaboutLibraries.exportVariant=release
      - RUST_VERSION=$(sed -n -E "s/.*rustup default ([0-9.]+).*/\1/p" ../.github/workflows/publish-release.yml
        | head -n 1)
      - '[[ $RUST_VERSION ]] || exit 1'
      - $$rustup$$/rustup-init.sh -y --default-toolchain $RUST_VERSION --target aarch64-linux-android
        x86_64-linux-android

  - versionName: 1.7.2
    versionCode: 172
    commit: v1.7.2
    subdir: composeApp
    gradle:
      - yes
    srclibs:
      - rustup@1.27.1
    rm:
      - iosApp
      - plugin
    prebuild:
      - sed -i -e '/compose-desktop-build-windows/d' -e '/foojay/d' -e '/jogamp/d'
        ../settings.gradle.kts
      - sed -i -e '/signConfig/d' -e '/top.kagg886.compose.installer.windows/d' -e
        '/configureComposeWindowsInstaller {/,/^}/d' build.gradle.kts
      - echo -e '\nAPP_VERSION_NAME=v$$VERSION$$' >> ../gradle.properties
      - gradle exportLibraryDefinitions -PaboutLibraries.exportVariant=release
      - RUST_VERSION=$(sed -n -E "s/.*rustup default ([0-9.]+).*/\1/p" ../.github/workflows/publish-release.yml
        | head -n 1)
      - '[[ $RUST_VERSION ]] || exit 1'
      - $$rustup$$/rustup-init.sh -y --default-toolchain $RUST_VERSION --target aarch64-linux-android
        x86_64-linux-android

  - versionName: 1.8.1
    versionCode: 181
    commit: 97c5aec6156908d1a6bb15919a27620acc234523
    subdir: composeApp
    gradle:
      - yes
    srclibs:
      - rustup@1.27.1
    rm:
      - iosApp
      - plugin
    prebuild:
      - sed -i -e '/compose-desktop-build-windows/d' -e '/foojay/d' -e '/jogamp/d'
        ../settings.gradle.kts
      - sed -i -e '/signConfig/d' -e '/top.kagg886.compose.installer.windows/d' -e
        '/configureComposeWindowsInstaller {/,/^}/d' build.gradle.kts
      - echo -e '\nAPP_VERSION_NAME=v$$VERSION$$' >> ../gradle.properties
      - gradle exportLibraryDefinitions -PaboutLibraries.exportVariant=release
      - RUST_VERSION=$(sed -n -E 's/channel = "([0-9.]+)"/\1/p' ../rust-toolchain.toml)
      - '[[ $RUST_VERSION ]]'
      - $$rustup$$/rustup-init.sh -y --default-toolchain $RUST_VERSION --target aarch64-linux-android
        x86_64-linux-android

  - versionName: 1.8.2
    versionCode: 182
    commit: b57af13e8bd1d69ab106316cf180b5d1d1fae9c0
    subdir: composeApp
    gradle:
      - yes
    srclibs:
      - rustup@1.27.1
    rm:
      - iosApp
      - plugin
    prebuild:
      - sed -i -e '/compose-desktop-build-windows/d' -e '/foojay/d' -e '/jogamp/d'
        ../settings.gradle.kts
      - sed -i -e '/signConfig/d' -e '/top.kagg886.compose.installer.windows/d' -e
        '/configureComposeWindowsInstaller {/,/^}/d' build.gradle.kts
      - echo -e '\nAPP_VERSION_NAME=v$$VERSION$$' >> ../gradle.properties
      - gradle exportLibraryDefinitions -PaboutLibraries.exportVariant=release
      - RUST_VERSION=$(sed -n -E 's/channel = "([0-9.]+)"/\1/p' ../rust-toolchain.toml)
      - '[[ $RUST_VERSION ]]'
      - $$rustup$$/rustup-init.sh -y --default-toolchain $RUST_VERSION --target aarch64-linux-android
        x86_64-linux-android

  - versionName: 1.8.3
    versionCode: 183
    commit: 219392a8078fabf3ef9cd3873f58327b0a6ddc2f
    subdir: composeApp
    gradle:
      - yes
    srclibs:
      - rustup@1.27.1
    rm:
      - iosApp
    prebuild:
      - sed -i -e '/compose-desktop-build-windows/d' -e '/foojay/d' -e '/jogamp/d'
        ../settings.gradle.kts
      - sed -i -e '/signConfig/d' -e '/top.kagg886.compose.installer.windows/d' -e
        '/configureComposeWindowsInstaller {/,/^}/d' build.gradle.kts
      - echo -e '\nAPP_VERSION_NAME=v$$VERSION$$' >> ../gradle.properties
      - gradle exportLibraryDefinitions -PaboutLibraries.exportVariant=release
      - RUST_VERSION=$(sed -n -E 's/channel = "([0-9.]+)"/\1/p' ../rust-toolchain.toml)
      - '[[ $RUST_VERSION ]]'
      - $$rustup$$/rustup-init.sh -y --default-toolchain $RUST_VERSION --target aarch64-linux-android
        x86_64-linux-android

  - versionName: 1.8.4
    versionCode: 184
    commit: 868130d3e4a13af3a0e4f07b01d85c8800a2ed25
    subdir: composeApp
    sudo:
      - apt-get update
      - apt-get install rustup gcc libc-dev
    gradle:
      - yes
    rm:
      - iosApp
    prebuild:
      - sed -i -e '/compose-desktop-build-windows/d' -e '/foojay/d' -e '/jogamp/d'
        ../settings.gradle.kts
      - sed -i -e '/signConfig/d' -e '/top.kagg886.compose.installer.windows/d' -e
        '/configureComposeWindowsInstaller {/,/^}/d' build.gradle.kts
      - sed -i -e '/jvmToolchain/d' -e 's/androidTarget()/androidTarget() { compilerOptions
        { jvmTarget.set(org.jetbrains.kotlin.gradle.dsl.JvmTarget.JVM_17) } }/' -e
        's/jvm(\(.*\))/jvm(\1) { compilations.all { compilerOptions.configure { jvmTarget.set(org.jetbrains.kotlin.gradle.dsl.JvmTarget.JVM_17)
        } } }/' -e '/android {/a compileOptions { targetCompatibility = JavaVersion.VERSION_17\nsourceCompatibility
        = JavaVersion.VERSION_17 }' -e '/androidTarget {/a compilerOptions { jvmTarget.set(org.jetbrains.kotlin.gradle.dsl.JvmTarget.JVM_17)
        }' ../lib/*/build.gradle.kts build.gradle.kts
      - echo -e '\nAPP_VERSION_NAME=v$$VERSION$$' >> ../gradle.properties
      - gradle exportLibraryDefinitions -PaboutLibraries.exportVariant=release
      - RUST_VERSION=$(sed -n -E 's/channel = "([0-9.]+)"/\1/p' ../rust-toolchain.toml)
      - '[[ $RUST_VERSION ]]'
      - rustup default $RUST_VERSION
      - rustup target add aarch64-linux-android x86_64-linux-android

AllowedAPKSigningKeys: 0d0a5b77ee74694c0b63cb663f0639785603583610683da6f0aa2e73f7ff3bbc

AutoUpdateMode: Version v%v
UpdateCheckMode: HTTP
UpdateCheckData: https://github.com/magic-cucumber/Pixiv-MultiPlatform/releases/latest|>v[\d.]+
  - (\d+)</h1>|.|>v([\d.]+) - \d+</h1>
CurrentVersion: 1.8.4
CurrentVersionCode: 184
