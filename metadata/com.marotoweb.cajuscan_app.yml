Categories:
  - Money
License: MIT
AuthorName: Roberto Cc
SourceCode: https://github.com/marotoweb/cajuscan_app
IssueTracker: https://github.com/marotoweb/cajuscan_app/issues

AutoName: CajuScan

RepoType: git
Repo: https://github.com/marotoweb/cajuscan_app.git
Binaries: https://github.com/marotoweb/cajuscan_app/releases/download/v%v/CajuScan-v%v.apk

Builds:
  - versionName: 1.0.4
    versionCode: 5
    commit: d92467fede7b8d2c459ce9dd0a7210f32755dbd8
    sudo:
      - mkdir -p /home/runner
      - chown vagrant /home/runner
    output: build/app/outputs/flutter-apk/app-release.apk
    srclibs:
      - flutter@stable
    prebuild:
      - export repo=/home/runner/work/cajuscan_app
      - mkdir -p $repo
      - cd ..
      - mv com.marotoweb.cajuscan_app $repo/cajuscan_app
      - pushd $repo/cajuscan_app
      - export RELEASE_FILE=.github/workflows/release-builder.yml
      - ver=$(sed -n -E "s/.*flutter-version:\ '(.*)'/\1/p" $RELEASE_FILE|head -n1)
      - '[[ $ver ]]'
      - git -C $$flutter$$ checkout -f $ver
      - export PUB_CACHE=$(pwd)/.pub-cache
      - $$flutter$$/bin/flutter config --no-analytics
      - $$flutter$$/bin/flutter pub get --enforce-lockfile
      - export LOCATION=$PUB_CACHE/hosted/pub.dev/flutter_zxing-*/*/CMakeLists.txt
      - export OPTS="-ffile-prefix-map=$(pwd)=/tmp/build"
      - sed -i "1a add_link_options(\"LINKER:--build-id=none\")" $LOCATION
      - sed -i "1a add_compile_options(\"$OPTS\")" $LOCATION
      - popd
      - mv $repo/cajuscan_app com.marotoweb.cajuscan_app
    scandelete:
      - .pub-cache
    build:
      - export repo=/home/runner/work/cajuscan_app
      - cd ..
      - mv com.marotoweb.cajuscan_app $repo/cajuscan_app
      - pushd $repo/cajuscan_app
      - export PUB_CACHE=$(pwd)/.pub-cache
      - export PATH=$$flutter$$/bin/:$PATH
      - $$flutter$$/bin/flutter build apk --release --no-tree-shake-icons
      - popd
      - mv $repo/cajuscan_app com.marotoweb.cajuscan_app
    ndk: 27.0.12077973

AllowedAPKSigningKeys: b1bd4eb13022a25b6b0ac9b079ea255feac109d7a613c9448c287ee822ab19b2

AutoUpdateMode: Version
UpdateCheckMode: Tags
UpdateCheckData: pubspec.yaml|version:\s.+\+(\d+)|.|version:\s(.+)\+
CurrentVersion: 1.0.4
CurrentVersionCode: 5
